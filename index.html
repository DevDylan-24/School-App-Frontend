<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script type="module" src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/7.1.0/ionicons/ionicons.esm.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <script nomodule src="https://cdnjs.cloudflare.com/ajax/libs/ionicons/7.1.0/ionicons/ionicons.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <title>School App</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="login.css">
    <link rel="stylesheet" href="cart.css">

</head>
<body>
    <div id="app">
        <!-- This the the HTML for the login page -->
        <div v-if="currentView == 'login'" id="login-container">
            <div class="container" id="container" :class="{ 'active': isSignUp }">
                <!-- Sign-up HTML -->
                <div class="form-container sign-up">
                    <form @submit.prevent="formHandler">
                        <h1>Create Account</h1>
                        <span>Sign up as:</span>
                        

                        <div class="glass-radio-group">
                            <input type="radio" name="plan" id="glass-silver" value="student" v-model="registerRole" checked=""/>
                            <label id="studentLabel" for="glass-silver" class="default-checked">Student</label>

                            <input type="radio" name="plan" id="glass-gold" value="tutor" v-model="registerRole" />
                            <label for="glass-gold" @click="removeColorClass">Tutor</label>

                            <div class="glass-glider"></div>
                        </div>


                        <input type="text" placeholder="Name" v-model="registerName">
                        <input type="email" placeholder="Email" v-model="registerEmail">
                        <input type="password" placeholder="Password" v-model="registerPassword">
                        <input type="text" placeholder="Phone Number" v-model="registerPhoneNumber">
                        

                        <div v-if="errorName && errorEmail" class="error-message" style="text-align: center;">Please enter a valid name and email</div>
                        <div v-else-if="errorEmail" class="error-message" style="text-align: center;">Please enter a valid email</div>
                        <div v-else-if="errorName" class="error-message" style="text-align: center;">Please enter a valid name</div>
                        <div v-if="errorPassword" class="error-message" style="text-align: center;">Password must be at least 8 characters, contain at least one capital letter and number</div>
                        <div v-if="errorPhoneNumber" class="error-message" style="text-align: center;">Invalid phone number, Enter a Mauritian phone number please</div>

                        <div v-if="registerError" class="error-message" style="text-align: center;"> User already exists. Please login to your account</div>


                        <button @click="SignUp">Sign Up</button>
                    </form>
                </div>
                <!-- Sign-in HTML -->
                <div class="form-container sign-in">
                    <form @submit.prevent="formHandler">
                        <h1>Sign In</h1>
                        <input type="email" placeholder="Email" v-model="loginEmail">
                        <input type="password" placeholder="Password" v-model="loginPassword">


                        <div v-if="errorEmail" class="error-message" style="text-align: center;">Please enter a valid email</div>
                        <div v-if="errorPassword" class="error-message" style="text-align: center;">Invalid password entered</div>
                        <div v-if="loginError" class="error-message" style="text-align: center;"> {{ errorLoginMessage }} </div>

                        <button @click="Login">Sign In</button>
                    </form>
                </div>
                <div class="toggle-container">
                    <div class="toggle">
                        <div class="toggle-panel toggle-left">
                            <h1>Welcome Back!</h1>
                            <p>We're excited to see what you'll learn today. Log in to access your courses and resources.</p>
                            <button class="hidden" id="login" @click="ToggleSignUp">Sign In</button>
                        </div>
                        <div class="toggle-panel toggle-right">
                            <h1>Hello, Dear User!</h1>
                            <p>Register with your personal details and let's kickstart your learning adventure</p>
                            <button class="hidden" id="register" @click="ToggleSignUp">Sign Up</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- HTML for navbar -->
        <nav class="navbar" v-if="currentView !== 'login'">
            <div class="navbar-content">
                <div class="logo">
                    <ion-icon name="book"></ion-icon>
                    The Learning Lounge
                </div>
                <ul class="nav-links">
                    <li><button @click="changeView('home')"><ion-icon name="home" class="nav-icon"></ion-icon>Home</button></li>
                    <li><button @click="toggleCartAndHome('cart')" :disabled="isDisabled"><ion-icon name="cart" class="nav-icon"></ion-icon>My Cart<span class="cart-badge" v-if="cartCount > 0">{{ cartCount }}</span></button></li>
                    <li><button @click="changeView('courses')"><ion-icon name="library" class="nav-icon"></ion-icon>My Courses</button></li>
                </ul>
                <div class="search-bar" v-if="currentView === 'home'">
                    <div class="search-input-wrapper">
                        <ion-icon name="search" class="search-icon"></ion-icon>
                        <input 
                            type="text" 
                            placeholder="Search lessons by subject, location, price, or availability..." 
                            v-model="searchQuery"
                            @input="handleSearch"
                        >
                    </div>
                    <button>
                        <ion-icon name="search-outline"></ion-icon>
                        Search
                    </button>
                </div>
            </div>
        </nav>


        <!-- My cart page view -->
        <div v-if="currentView == 'cart'" class="placeholder-view">
            <div class="cart-container">
                <!-- Page Header -->
                <div class="page-header">
                    <h1>
                        <ion-icon name="cart"></ion-icon>
                        Shopping Cart
                    </h1>
                    <p class="items-count" v-if="cart.length > 0">{{ cart.length }} {{ cart.length === 1 ? 'item' : 'items' }} in your cart</p>
                </div>

                <!-- Empty Cart State -->
                <div class="empty-cart" v-if="cart.length === 0">
                    <ion-icon name="cart-outline"></ion-icon>
                    <h2>Your cart is empty</h2>
                    <p>Add some lessons to get started with your learning journey!</p>
                    <button class="browse-btn" @click="changeView('home')">
                        <ion-icon name="search"></ion-icon>
                        Browse Lessons
                    </button>
                </div>

                <!-- Cart Content -->
                <div class="cart-content" v-else>
                    <!-- Cart Items -->
                    <div class="cart-items">
                        <div class="cart-item" v-for="lesson in cart" :key="lesson._id">
                            <div class="item-image" @error="handleImageError(lesson)" :style="{ backgroundImage: 'url(' + getImageUrl(lesson.image) + ')' }"></div>
                            <div class="item-details">
                                <div class="item-header">
                                    <h3 class="item-title">{{ lesson.title }}</h3>
                                    <button class="remove-btn" @click="removeFromCart(lesson._id)">
                                        <ion-icon name="trash-bin-sharp"></ion-icon>
                                        Remove
                                    </button>
                                </div>

                                <div class="item-info">
                                    <div class="info-item">
                                        <ion-icon name="person-outline" class="info-icon"></ion-icon>
                                        <span>{{ lesson.tutor }}</span>
                                    </div>
                                    <div class="info-item">
                                        <ion-icon name="location-outline" class="info-icon"></ion-icon>
                                        <span>{{ lesson.location }}</span>
                                    </div>
                                    <div class="info-item">
                                        <ion-icon name="calendar-outline" class="info-icon"></ion-icon>
                                        <span>{{ lesson.schedule }}</span>
                                    </div>
                                    <div class="info-item">
                                        <ion-icon name="time-outline" class="info-icon"></ion-icon>
                                        <span>{{ lesson.duration }}</span>
                                    </div>

                                    <div class="detail-item">
                                        <ion-icon name="people-outline" class="detail-icon"></ion-icon>
                                        <span>Spaces left: {{ lesson.spaces }}</span>
                                    </div>
                                </div>

                                <div class="item-footer">
                                    <div class="item-price">£{{ lesson.price }}</div>
                                     <div style="font-size: 1.2rem;">Spaces booked : {{ lesson.spacesBooked }}</div>
                                    <div class="item-rating">
                                        <span class="stars">★★★★★</span>
                                        <span>{{ lesson.rating }} ({{ lesson.reviews }})</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Cart Summary -->
                    <div class="cart-summary">
                        <h2 class="summary-title">Order Summary</h2>
                        
                        <div class="summary-item subtotal" v-for="lesson in cart" :key="lesson._id">
                            <span> {{lesson.title}} </span>
                            <span class="summary-price"> £{{lesson.price * lesson.spacesBooked}} </span>
                        </div>

                        <div class="summary-item total">
                            <span>Total</span>
                            <span class="total-price">£{{ total.toFixed(2) }}</span>
                        </div>

                        <div class="checkout-input">
                            <input type="text" placeholder="Name" v-model="checkoutName">
                            <input type="text" placeholder="Phone Number" v-model="checkoutPhoneNumber">
                        </div>

                        <div v-if="errorCheckoutPhoneNumber || errorCheckoutName" class="error-message" style="text-align: center;">Invalid credentials entered</div>

                        <button class="checkout-btn" @click="checkout" :disabled="!isCheckoutValid"> 
                            <!--  this.disableCheckout = false; -->
                            <ion-icon name="card"></ion-icon>
                            Checkout
                        </button>

                        <button class="continue-shopping" @click="changeView('home')">
                            <ion-icon name="arrow-back"></ion-icon>
                            Continue Shopping
                        </button>
                    </div>
                </div>
            </div>
        </div>


        <!-- My courses page view -->
        <div v-if="currentView == 'courses'">
            <h2>{{ currentView.charAt(0).toUpperCase() + currentView.slice(1) }} Page</h2>
            <p>This is a placeholder for the {{ currentView }} view.</p>
            <button @click="changeView('home')">Back to Home</button>
        </div>

        <!-- HTML for main home page content -->
        <div class="main-container" v-if="currentView === 'home'">
            <!-- Sidebar -->
            <aside class="sidebar">
                <div class="sidebar-header">
                    <h3>Sort Options</h3>
                </div>
                
                <div class="filter-section">
                        <h4>Sort By</h4>
                        <div class="sort-option" v-for="option in sortOptions" :key="option.value">
                            <input 
                                type="radio" 
                                :id="'sort-' + option.value"
                                :value="option.value"
                                v-model="sortBy"
                                @change="sortLessons"
                                name="sortBy"
                            >
                            <label :for="'sort-' + option.value">
                                <ion-icon :name="option.icon"></ion-icon>
                                {{ option.label }}
                            </label>
                        </div>
                    </div>

                    <div class="filter-section">
                        <h4>Sort Order</h4>
                        <div class="sort-option">
                            <input 
                                type="radio" 
                                id="order-asc"
                                value="asc"
                                v-model="sortOrder"
                                @change="sortLessons"
                                name="sortOrder"
                            >
                            <label for="order-asc">
                                <ion-icon name="arrow-up-outline"></ion-icon>
                                Ascending
                            </label>
                        </div>
                        <div class="sort-option">
                            <input 
                                type="radio" 
                                id="order-desc"
                                value="desc"
                                v-model="sortOrder"
                                @change="sortLessons"
                                name="sortOrder"
                            >
                            <label for="order-desc">
                                <ion-icon name="arrow-down-outline"></ion-icon>
                                Descending
                            </label>
                        </div>
                    </div>

                    <button class="clear-filters" @click="resetSort">
                        <ion-icon name="refresh-outline"></ion-icon>
                        Reset Sort
                    </button>
            </aside>
            <div v-if="error" class="error">{{ error }}</div>
            <!-- Lessons Grid -->
            <main class="lessons-container">
                <div class="lessons-header">
                    <h1>Available Lessons</h1>
                    <p class="results-count">{{ searchResults.length }} lessons available</p>
                </div>

                <div class="lessons-grid" v-if="searchResults.length > 0">
                    <div class="lesson-card" v-for="lesson in searchResults" :key="lesson._id">
                        <div class="lesson-image" @error="handleImageError(lesson)" :style="{ backgroundImage: 'url(' + getImageUrl(lesson.image) + ')' }"></div>
                        <div class="lesson-content">
                            <h3 class="lesson-title">{{ lesson.title }}</h3>
                            
                            <div class="lesson-details">
                                <div class="detail-item">
                                    <ion-icon name="book-outline" class="detail-icon"></ion-icon>
                                    <span style="font-weight: 750;">{{ lesson.subject }}</span>
                                </div>
                                <div class="detail-item">
                                    <ion-icon name="person-outline" class="detail-icon"></ion-icon>
                                    <span>{{ lesson.tutor }}</span>
                                </div>
                                <div class="detail-item">
                                    <ion-icon name="location-outline" class="detail-icon"></ion-icon>
                                    <span>{{ lesson.location }}</span>
                                </div>
                                <div class="detail-item">
                                    <ion-icon name="calendar-outline" class="detail-icon"></ion-icon>
                                    <span>{{ lesson.schedule }}</span>
                                </div>
                                <div class="detail-item">
                                    <ion-icon name="time-outline" class="detail-icon"></ion-icon>
                                    <span>{{ lesson.duration }}</span>
                                </div>
                                <div class="detail-item">
                                    <ion-icon name="people-outline" class="detail-icon"></ion-icon>
                                    <span>Spaces left: {{ lesson.spaces }}</span>
                                </div>
                                <div class="lesson-rating">
                                    <span class="stars">★★★★★</span>
                                    <span>{{ lesson.rating }}</span>
                                    <span class="rating-count">({{ lesson.reviews }} reviews)</span>
                                </div>
                                <div class="spaces-available" v-if="lesson.spaces <= 5">
                                    {{ lesson.spaces == 0 ? 'Out of stock' : `Only ${lesson.spaces} spaces left!` }}
                                </div>
                            </div>
                           

                            <div class="lesson-footer">

                                <div class="lesson-price">£{{ lesson.price }}</div>
                                 <div>Spaces booked : {{ lesson.spacesBooked }}</div>
                                <button 
                                    class="add-to-cart-btn"
                                    @click="addToCart(lesson)"
                                    :disabled="lesson.spaces == 0"
                                    
                                >
                                      Add to Cart
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div v-else-if="loading" class="no-results">
                    <h2>Loading lessons...</h2>
                </div>
                <div class="no-results" v-else>
                    <h2>No lessons found</h2>
                    <p>Try adjusting your search query</p>
                </div>
            </main>
        </div>
      
    </div>
    <script type="module" src="app.js"></script>
</body>
</html>